{% extends 'base.html' %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">

    <h1 class="mb-4 text-center">Profile</h1>

    <div class="profile-info mb-4 text-center">
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Role:</strong> {{ user.role }}</p>
    </div>

    <div class="edit-navbar mb-3">
        <a href="#" id="toggle-profile-form-link" class="nav-link" style="color: black; font-weight: 600;">
            Show Edit Profile Form
        </a>
    </div>

    <div id="profile-form" style="display: none;">
        <form method="POST" action="{{ url_for('main.update_profile') }}" id="profile-update-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input
                    type="text"
                    name="username"
                    id="username"
                    class="form-control"
                    value="{{ user.username }}"
                    required
                >
            </div>
            
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                    type="email"
                    name="email"
                    id="email"
                    class="form-control"
                    value="{{ user.email }}"
                    required
                >
            </div>
            
            <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const toggleLink = document.getElementById('toggle-profile-form-link');
    const profileForm = document.getElementById('profile-form');

    toggleLink.addEventListener('click', (e) => {
        e.preventDefault();
        if (profileForm.style.display === 'none' || profileForm.style.display === '') {
            profileForm.style.display = 'block';
            toggleLink.textContent = 'Hide Edit Profile Form';
        } else {
            profileForm.style.display = 'none';
            toggleLink.textContent = 'Show Edit Profile Form';
        }
    });

    // Confirmation before submitting update form
    const updateForm = document.getElementById('profile-update-form');
    updateForm.addEventListener('submit', (e) => {
        if (!confirm('Are you sure you want to update your profile?')) {
            e.preventDefault();
        }
    });
});
</script>

{% endblock %}
