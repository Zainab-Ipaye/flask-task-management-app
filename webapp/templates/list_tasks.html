{% extends 'base.html' %}

{% block content %}
    <div class="edit-navbar">
        <a href="{{ url_for('main.create_task') }}" class="nav-link">Create Task</a>
    </div>

 <!-- Navbar for Filter List (Visible if tasks count >= 1) -->
 {% if tasks|length >= 1 %}
 <nav class="navbar navbar-expand-lg navbar-light mb-4" style="background-color: transparent; box-shadow: none;">
     <div class="container-fluid">
         <!-- Align "Filter List" button to the right -->
        <div class="d-flex ms-auto">
        <a href="#" id="filter-toggle-btn" class="nav-link">Filter</a>
        </div>
     </div>
 </nav>
 {% endif %}

 
<div class="container">
    <!-- Navbar for Add New Task -->
    <nav class="navbar navbar-expand-lg navbar-light mb-4" style="background-color: transparent; box-shadow: none;">
        <div class="container-fluid">
            <!-- Align "Add New Task" button to the right -->
        </div>
    </nav>


    <!-- Filter Form (Initially Hidden) -->
    <form method="GET" action="{{ url_for('main.list_tasks') }}" class="form-inline mb-4" id="filter-form" style="display: none;">
        <div class="form-group">
            <label for="assignee_filter" class="mr-2">Assigned To:</label>
            <select name="assignee" id="assignee_filter" class="form-control mr-4">
                <option value="">All</option>
                {% for user in users %}
                <option value="{{ user.id }}" {% if request.args.get('assignee') == user.id|string %}selected{% endif %}>
                    {{ user.username }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="project_filter" class="mr-2">Project:</label>
            <select name="project" id="project_filter" class="form-control mr-4">
                <option value="">All</option>
                {% for project in projects %}
                <option value="{{ project.id }}" {% if request.args.get('project') == project.id|string %}selected{% endif %}>
                    {{ project.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <!-- Apply Filter Button -->
        <div class="form-group ms-auto">
            <button type="submit" class="nav-link" style="border: none; background: none;">Apply Filter</button>
        </div>
    </form>

    <!-- Task Table -->
    <table class="styled-table">
        <thead>
            <tr>
                <!--   <th>#</th> -->

                <th>Title</th>
                <th>Status</th>
                <th>Hours Remaining</th> 
                <th>Assigned To</th>
                <th>Actions</th>

            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
              <!--   <td>{{ loop.index }}</td> -->
                <td>{{ task.title }}</td>
                <td><span class="badge {{ task.status|lower|replace(' ', '-') }}">{{ task.status }}</span></td>
                <td>{{ task.hours_remaining }}</td>
                <td>{{ task.assignee.username if task.assignee else 'N/A' }}</td>
                <td>
                    <!-- Edit & Delete link for each task -->
                    <a href="{{ url_for('main.edit_task', task_id=task.id) }}" style="color: #28a745; font-size: 20px; cursor: pointer;" title="Edit Task">
                        üñäÔ∏è
                    </a>
                    <form action="{{ url_for('main.delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                        <button type="submit" style="border: none; background: transparent; color: #dc3545; cursor: pointer;" title="Delete Task" onclick="return confirm('Are you sure you want to delete this task?')">
                            üóëÔ∏è
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>



{% if pagination.pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('main.list_tasks', page=pagination.prev_num) }}">Previous</a>
        </li>
      {% endif %}
      <li class="page-item disabled"><a class="page-link">Page {{ pagination.page }} of {{ pagination.pages }}</a></li>
      {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('main.list_tasks', page=pagination.next_num) }}">Next</a>
        </li>


      {% endif %}
    </ul>
  </nav>
  {% endif %}

{% endblock %}

